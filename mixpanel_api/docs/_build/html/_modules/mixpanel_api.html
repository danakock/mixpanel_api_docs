<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mixpanel_api &#8212; mixpanel_api 1.6.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.6.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mixpanel_api 1.6.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mixpanel_api</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">urllib</span>  <span class="c1"># for url encoding</span>
<span class="kn">import</span> <span class="nn">urllib2</span>  <span class="c1"># for sending requests</span>
<span class="kn">from</span> <span class="nn">httplib</span> <span class="k">import</span> <span class="n">IncompleteRead</span>
<span class="kn">from</span> <span class="nn">ssl</span> <span class="k">import</span> <span class="n">SSLError</span>
<span class="kn">import</span> <span class="nn">cStringIO</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">isfunction</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">cpu_count</span>
<span class="kn">from</span> <span class="nn">multiprocessing.pool</span> <span class="k">import</span> <span class="n">ThreadPool</span>
<span class="kn">from</span> <span class="nn">paginator</span> <span class="k">import</span> <span class="n">ConcurrentPaginator</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="k">import</span> <span class="n">literal_eval</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">unicodecsv</span> <span class="k">as</span> <span class="nn">csv</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">csv</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ujson</span> <span class="k">as</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ciso8601</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># If ciso8601 is not installed datetime will be used instead</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="Mixpanel"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel">[docs]</a><span class="k">class</span> <span class="nc">Mixpanel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object for querying, importing, exporting and modifying Mixpanel data via their various APIs</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FORMATTED_API</span> <span class="o">=</span> <span class="s1">&#39;https://mixpanel.com/api&#39;</span>
    <span class="n">RAW_API</span> <span class="o">=</span> <span class="s1">&#39;https://data.mixpanel.com/api&#39;</span>
    <span class="n">IMPORT_API</span> <span class="o">=</span> <span class="s1">&#39;https://api.mixpanel.com&#39;</span>
    <span class="n">BETA_IMPORT_API</span> <span class="o">=</span> <span class="s1">&#39;https://api-beta.mixpanel.com&#39;</span>
    <span class="n">VERSION</span> <span class="o">=</span> <span class="s1">&#39;2.0&#39;</span>
    <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Public, external methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Mixpanel.__init__"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">read_pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the Mixpanel object</span>

<span class="sd">        :param api_secret: API Secret for your project</span>
<span class="sd">        :param token: Project Token for your project, required for imports</span>
<span class="sd">        :param dataset_id: The name of the dataset to operate on</span>
<span class="sd">        :param timeout: Time in seconds to wait for HTTP responses</span>
<span class="sd">        :param pool_size: Number of threads to use for sending data to Mixpanel (Default value = cpu_count * 2)</span>
<span class="sd">        :param read_pool_size: Separate number of threads to use just for read operations (i.e. query_engage)</span>
<span class="sd">            (Default value = 2)</span>
<span class="sd">        :param max_retries: Maximum number of times to retry when a 5xx HTTP response is received (Default value = 4)</span>
<span class="sd">        :param debug: Enable debug logging</span>
<span class="sd">        :type api_secret: str</span>
<span class="sd">        :type token: str</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :type pool_size: int</span>
<span class="sd">        :type read_pool_size: int</span>
<span class="sd">        :type max_retries: int</span>
<span class="sd">        :type debug: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span> <span class="o">=</span> <span class="n">api_secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="o">=</span> <span class="n">dataset_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="k">if</span> <span class="n">pool_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default number of threads is system dependent</span>
            <span class="n">pool_size</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span> <span class="o">=</span> <span class="n">pool_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_pool_size</span> <span class="o">=</span> <span class="n">read_pool_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="n">log_level</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39; The logger is a singleton for the Mixpanel class, so multiple instances of the Mixpanel class will use the</span>
<span class="sd">        same logger instance. Subsequent instances can upgrade the logging level to debug but they cannot downgrade it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">or</span> <span class="n">log_level</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel.export_data"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.export_data">[docs]</a>    <span class="k">def</span> <span class="nf">export_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">append_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes and optionally compresses Mixpanel data to disk in json or csv format</span>

<span class="sd">        :param data: A list of Mixpanel events or People profiles, if format=&#39;json&#39;, arbitrary json can be exported</span>
<span class="sd">        :param output_file: Name of file to write to</span>
<span class="sd">        :param append_mode: Set this to True to append data to an existing file using open() mode &#39;a+&#39;, uses open() mode</span>
<span class="sd">            &#39;w+&#39; when False (Default value = False)</span>
<span class="sd">        :param format:  Output format can be &#39;json&#39; or &#39;csv&#39; (Default value = &#39;json&#39;)</span>
<span class="sd">        :param compress:  Option to gzip output (Default value = False)</span>
<span class="sd">        :type data: list</span>
<span class="sd">        :type output_file: str</span>
<span class="sd">        :type append_mode: bool</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :type compress: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">open_mode</span> <span class="o">=</span> <span class="s1">&#39;w+&#39;</span>
        <span class="k">if</span> <span class="n">append_mode</span><span class="p">:</span>
            <span class="n">open_mode</span> <span class="o">=</span> <span class="s1">&#39;a+&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">open_mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_write_items_to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid format - must be &#39;json&#39; or &#39;csv&#39;: format = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                      <span class="o">+</span> <span class="s2">&quot;Dumping json to &quot;</span> <span class="o">+</span> <span class="n">output_file</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_gzip_file</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel.sum_transactions"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.sum_transactions">[docs]</a>    <span class="k">def</span> <span class="nf">sum_transactions</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dict with a single key, &#39;Revenue&#39; and the sum of all $transaction $amounts for the given profile as</span>
<span class="sd">        the value</span>

<span class="sd">        :param profile: A Mixpanel People profile dict</span>
<span class="sd">        :type profile: dict</span>
<span class="sd">        :return: A dict with key &#39;Revenue&#39; and value containing the sum of all $transactions for the give profile</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">transactions</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;$properties&#39;</span><span class="p">][</span><span class="s1">&#39;$transactions&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;$amount&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Revenue&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">}</span></div>

<div class="viewcode-block" id="Mixpanel.request"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.request">[docs]</a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">path_components</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base method for sending HTTP requests to the various Mixpanel APIs</span>

<span class="sd">        :param base_url: Ex: https://api.mixpanel.com</span>
<span class="sd">        :param path_components: endpoint path as list of strings</span>
<span class="sd">        :param params: dictionary containing the Mixpanel parameters for the API request</span>
<span class="sd">        :param method: HTTP method verb: &#39;GET&#39;, &#39;POST&#39;, &#39;PUT&#39;, &#39;DELETE&#39;, &#39;PATCH&#39;</span>
<span class="sd">        :param headers: HTTP request headers dict (Default value = None)</span>
<span class="sd">        :param raw_stream: Return the raw file-like response directly from urlopen, only works when base_url is</span>
<span class="sd">            Mixpanel.RAW_API</span>
<span class="sd">        :param retries: number of times the request has been retried (Default value = 0)</span>
<span class="sd">        :type base_url: str</span>
<span class="sd">        :type path_components: list</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :type headers: dict</span>
<span class="sd">        :type raw_stream: bool</span>
<span class="sd">        :type retries: int</span>
<span class="sd">        :return: JSON data returned from API</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
            <span class="c1"># Add API version to url path if needed</span>
            <span class="k">if</span> <span class="n">base_url</span> <span class="o">==</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">IMPORT_API</span> <span class="ow">or</span> <span class="n">base_url</span> <span class="o">==</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">BETA_IMPORT_API</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_url</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_url</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">VERSION</span><span class="p">)]</span>

            <span class="n">request_url</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">path_components</span><span class="p">)</span>

            <span class="n">encoded_params</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_unicode_urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

            <span class="c1"># Set up request url and body based on HTTP method and endpoint</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">request_url</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">encoded_params</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">encoded_params</span>
                <span class="k">if</span> <span class="n">base_url</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMPORT_API</span> <span class="ow">or</span> <span class="s1">&#39;import-people&#39;</span> <span class="ow">in</span> <span class="n">path_components</span> <span class="ow">or</span> <span class="s1">&#39;import-events&#39;</span> <span class="ow">in</span> <span class="n">path_components</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="s1">&#39;&amp;verbose=1&#39;</span>
                    <span class="c1"># Uncomment the line below to log the request body data</span>
                    <span class="c1"># Mixpanel.LOGGER.debug(method + &#39; data: &#39; + data)</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request Method: &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request URL: &quot;</span> <span class="o">+</span> <span class="n">request_url</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Basic </span><span class="si">{encoded_secret}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">encoded_secret</span><span class="o">=</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">))</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request Headers: &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">headers</span><span class="p">))</span>
            <span class="c1"># This is the only way to use HTTP methods other than GET or POST with urllib2</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;GET&#39;</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">get_method</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">method</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">raw_stream</span> <span class="ow">and</span> <span class="n">base_url</span> <span class="o">==</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">RAW_API</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">response</span>
            <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;The server couldn</span><span class="se">\&#39;</span><span class="s1">t fulfill the request.&#39;</span><span class="p">)</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error code: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Reason: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Response: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
                    <span class="c1"># Retry if we get an HTTP 5xx error</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Attempting retry #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">path_components</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                 <span class="n">raw_stream</span><span class="o">=</span><span class="n">raw_stream</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;We failed to reach a server.&#39;</span><span class="p">)</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Reason: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Response: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Attempting retry #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">path_components</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">raw_stream</span><span class="o">=</span><span class="n">raw_stream</span><span class="p">,</span>
                             <span class="n">retries</span><span class="o">=</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="s1">&#39;The read operation timed out&#39;</span><span class="p">:</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;The read operation timed out.&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">+</span> <span class="mi">30</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;Increasing timeout to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; and attempting retry #&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">path_components</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                 <span class="n">raw_stream</span><span class="o">=</span><span class="n">raw_stream</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If the response is gzipped we go ahead and decompress</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">info</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Encoding&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;gzip&#39;</span><span class="p">:</span>
                        <span class="n">buf</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
                        <span class="n">response_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">response_data</span>
                <span class="k">except</span> <span class="n">IncompleteRead</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Response data is incomplete. Attempting retry #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">path_components</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                 <span class="n">raw_stream</span><span class="o">=</span><span class="n">raw_stream</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Maximum retries reached. Request failed. Try again later.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span></div>

<div class="viewcode-block" id="Mixpanel.people_operation"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_operation">[docs]</a>    <span class="k">def</span> <span class="nf">people_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base method for performing any of the People analytics update operations</span>

<span class="sd">        https://mixpanel.com/help/reference/http#update-operations</span>

<span class="sd">        :param operation: A string with name of a Mixpanel People operation, like $set or $delete</span>
<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type operation: str</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot;Project token required for People operation!&quot;</span>
        <span class="k">if</span> <span class="n">profiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;profiles and query_params both provided, please use one or the other&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">profiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">profiles_list</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_list_from_argument</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">profiles_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_engage</span><span class="p">(</span><span class="n">query_params</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If both profiles and query_params are None just fetch all profiles</span>
            <span class="n">profiles_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_engage</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backup_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">backup_file</span> <span class="o">=</span> <span class="s2">&quot;backup_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">profiles_list</span><span class="p">,</span> <span class="n">backup_file</span><span class="p">,</span> <span class="n">append_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Set the dynamic flag to True if value is a function</span>
        <span class="n">dynamic</span> <span class="o">=</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_batches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IMPORT_API</span><span class="p">,</span> <span class="s1">&#39;engage&#39;</span><span class="p">,</span> <span class="n">profiles_list</span><span class="p">,</span>
                               <span class="p">[{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">])</span>

        <span class="n">profile_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">profiles_list</span><span class="p">)</span>
        <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">operation</span> <span class="o">+</span> <span class="s1">&#39; operation applied to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">profile_count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; profiles&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">profile_count</span></div>

<div class="viewcode-block" id="Mixpanel.people_delete"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_delete">[docs]</a>    <span class="k">def</span> <span class="nf">people_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the specified People profiles with the $delete operation and optionally creates a backup file</span>

<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = True)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles deleted</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$delete&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_set"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_set">[docs]</a>    <span class="k">def</span> <span class="nf">people_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets People properties for the specified profiles using the $set operation and optionally creates a backup file</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$set&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_set_once"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_set_once">[docs]</a>    <span class="k">def</span> <span class="nf">people_set_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets People properties for the specified profiles only if the properties do not yet exist, using the $set_once</span>
<span class="sd">        operation and optionally creates a backup file</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$set_once&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_unset"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_unset">[docs]</a>    <span class="k">def</span> <span class="nf">people_unset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unsets properties from the specified profiles using the $unset operation and optionally creates a backup file</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type value: list | (profile) -&gt; list</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$unset&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_add"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_add">[docs]</a>    <span class="k">def</span> <span class="nf">people_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increments numeric properties on the specified profiles using the $add operation and optionally creates a</span>
<span class="sd">        backup file</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type value: dict[str, float] | (profile) -&gt; dict[str, float]</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$add&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_append"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_append">[docs]</a>    <span class="k">def</span> <span class="nf">people_append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Appends values to list properties on the specified profiles using the $append operation and optionally creates</span>
<span class="sd">        a backup file.</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type value: dict | (profile) -&gt; dict</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$append&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_union"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_union">[docs]</a>    <span class="k">def</span> <span class="nf">people_union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Union a list of values with list properties on the specified profiles using the $union operation and optionally</span>
<span class="sd">        create a backup file</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type value: dict[str, list] | (profile) -&gt; dict[str, list]</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$union&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_remove"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_remove">[docs]</a>    <span class="k">def</span> <span class="nf">people_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes values from list properties on the specified profiles using the $remove operation and optionally</span>
<span class="sd">        creates a backup file</span>

<span class="sd">        :param value: Can be a static value applied to all profiles or a user-defined function (or lambda) that takes a</span>
<span class="sd">            profile as its only parameter and returns the value to use for the operation on the given profile</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type value: dict | (profile) -&gt; dict</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$remove&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.people_change_property_name"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_change_property_name">[docs]</a>    <span class="k">def</span> <span class="nf">people_change_property_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unset</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the value of an existing property into a new property and optionally unsets the existing property.</span>
<span class="sd">        Optionally creates a backup file.</span>

<span class="sd">        :param old_name: The name of an existing property.</span>
<span class="sd">        :param new_name: The new name to replace the old_name with</span>
<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. If both query_params and</span>
<span class="sd">            profiles are None all profiles with old_name set are targeted. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :param unset:  Option to unset the old_name property (Default value = True)</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :type unset: bool</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">profiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;(defined (properties[&quot;&#39;</span> <span class="o">+</span> <span class="n">old_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;]))&#39;</span><span class="p">}</span>
        <span class="n">profile_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$set&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">{</span><span class="n">new_name</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;$properties&#39;</span><span class="p">][</span><span class="n">old_name</span><span class="p">]},</span>
                                              <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                              <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                              <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$unset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">old_name</span><span class="p">],</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                  <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile_count</span></div>

<div class="viewcode-block" id="Mixpanel.people_revenue_property_from_transactions"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.people_revenue_property_from_transactions">[docs]</a>    <span class="k">def</span> <span class="nf">people_revenue_property_from_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a property named &#39;Revenue&#39; for the specified profiles by summing their $transaction $amounts and</span>
<span class="sd">        optionally creates a backup file</span>

<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles.</span>
<span class="sd">            Alternative to query_params. (Default value = None)</span>
<span class="sd">        :param query_params: Parameters to query /engage API. Alternative to profiles param. If both query_params and</span>
<span class="sd">            profiles are None, all profiles with $transactions are targeted. (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type query_params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">profiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;(defined (properties[&quot;$transactions&quot;]))&#39;</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$set&#39;</span><span class="p">,</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">sum_transactions</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                                     <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="n">backup</span><span class="p">,</span>
                                     <span class="n">backup_file</span><span class="o">=</span><span class="n">backup_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.deduplicate_people"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.deduplicate_people">[docs]</a>    <span class="k">def</span> <span class="nf">deduplicate_people</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prop_to_match</span><span class="o">=</span><span class="s1">&#39;$email&#39;</span><span class="p">,</span> <span class="n">merge_props</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines duplicate profiles based on the value of a specified property. The profile with the latest</span>
<span class="sd">        $last_seen is kept and the others are deleted. Optionally adds any properties from the profiles to be deleted to</span>
<span class="sd">        the remaining profile using $set_once. Backup files are always created.</span>

<span class="sd">        :param profiles: Can be a list of profiles or the name of a file containing a JSON array or CSV of profiles. If</span>
<span class="sd">            this is None all profiles with prop_to_match set will be downloaded. (Default value = None)</span>
<span class="sd">        :param prop_to_match: Name of property whose value will be used to determine duplicates</span>
<span class="sd">            (Default value = &#39;$email&#39;)</span>
<span class="sd">        :param merge_props:  Option to call $set_once on remaining profile with all props from profiles to be deleted.</span>
<span class="sd">            This ensures that any properties that existed on the duplicates but not on the remaining profile are</span>
<span class="sd">            preserved. (Default value = False)</span>
<span class="sd">        :param case_sensitive:  Option to use case sensitive or case insensitive matching (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type profiles: list | str</span>
<span class="sd">        :type prop_to_match: str</span>
<span class="sd">        :type merge_props: bool</span>
<span class="sd">        :type case_sensitive: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles deleted</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main_reference</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">update_profiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delete_profiles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">profiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">profiles_list</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_list_from_argument</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unless the user provides a list of profiles we only look at profiles which have the prop_to_match set</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="s1">&#39;(boolean(properties[&quot;&#39;</span> <span class="o">+</span> <span class="n">prop_to_match</span> <span class="o">+</span> <span class="s1">&#39;&quot;]) == true)&#39;</span>
            <span class="n">profiles_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_engage</span><span class="p">({</span><span class="s1">&#39;where&#39;</span><span class="p">:</span> <span class="n">selector</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backup_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">backup_file</span> <span class="o">=</span> <span class="s2">&quot;backup_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">profiles_list</span><span class="p">,</span> <span class="n">backup_file</span><span class="p">,</span> <span class="n">append_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">profiles_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">match_prop</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">profile</span><span class="p">[</span><span class="s2">&quot;$properties&quot;</span><span class="p">][</span><span class="n">prop_to_match</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
                <span class="n">match_prop</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;$properties&quot;</span><span class="p">][</span><span class="n">prop_to_match</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">case_sensitive</span><span class="p">:</span>
                        <span class="n">match_prop</span> <span class="o">=</span> <span class="n">match_prop</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># Ensure each value for the prop we are matching on has a key pointing to an array in the main_reference</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">main_reference</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">match_prop</span><span class="p">):</span>
                <span class="n">main_reference</span><span class="p">[</span><span class="n">match_prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Append each profile to the array under the key corresponding to the value it has for prop we are matching</span>
            <span class="n">main_reference</span><span class="p">[</span><span class="n">match_prop</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">matching_prop</span><span class="p">,</span> <span class="n">matching_profiles</span> <span class="ow">in</span> <span class="n">main_reference</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching_profiles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">matching_profiles</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">dupe</span><span class="p">:</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_dt_from_iso</span><span class="p">(</span><span class="n">dupe</span><span class="p">))</span>
                <span class="c1"># We create a $delete update for each duplicate profile and at the same time create a</span>
                <span class="c1"># $set_once update for the keeper profile by working through duplicates oldest to newest</span>
                <span class="k">if</span> <span class="n">merge_props</span><span class="p">:</span>
                    <span class="n">prop_update</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$distinct_id&quot;</span><span class="p">:</span> <span class="n">matching_profiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;$distinct_id&quot;</span><span class="p">],</span> <span class="s2">&quot;$properties&quot;</span><span class="p">:</span> <span class="p">{}}</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_profiles</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">delete_profiles</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">:</span> <span class="n">matching_profiles</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">]})</span>
                    <span class="k">if</span> <span class="n">merge_props</span><span class="p">:</span>
                        <span class="n">prop_update</span><span class="p">[</span><span class="s2">&quot;$properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">matching_profiles</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s2">&quot;$properties&quot;</span><span class="p">])</span>
                <span class="c1"># Remove $last_seen from any updates to avoid weirdness</span>
                <span class="k">if</span> <span class="n">merge_props</span> <span class="ow">and</span> <span class="s2">&quot;$last_seen&quot;</span> <span class="ow">in</span> <span class="n">prop_update</span><span class="p">[</span><span class="s2">&quot;$properties&quot;</span><span class="p">]:</span>
                    <span class="k">del</span> <span class="n">prop_update</span><span class="p">[</span><span class="s2">&quot;$properties&quot;</span><span class="p">][</span><span class="s2">&quot;$last_seen&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">merge_props</span><span class="p">:</span>
                    <span class="n">update_profiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop_update</span><span class="p">)</span>

        <span class="c1"># The &quot;merge&quot; is really just a $set_once call with all of the properties from the deleted profiles</span>
        <span class="k">if</span> <span class="n">merge_props</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$set_once&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;$properties&#39;</span><span class="p">],</span> <span class="n">profiles</span><span class="o">=</span><span class="n">update_profiles</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="s1">&#39;$delete&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">delete_profiles</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.query_jql"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.query_jql">[docs]</a>    <span class="k">def</span> <span class="nf">query_jql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Query the Mixpanel JQL API</span>

<span class="sd">        https://mixpanel.com/help/reference/jql/api-reference#api/access</span>

<span class="sd">        :param script: String containing a JQL script to run</span>
<span class="sd">        :param params: Optional dict that will be made available to the script as the params global variable.</span>
<span class="sd">        :param format: Output format can be either &#39;json&#39; or &#39;csv&#39;</span>
<span class="sd">        :type script: str</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :return: query output as json or a csv str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;script&quot;</span><span class="p">:</span> <span class="n">script</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo.csv&#39;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">FORMATTED_API</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;jql&#39;</span><span class="p">],</span> <span class="n">query_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="Mixpanel.jql_operation"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.jql_operation">[docs]</a>    <span class="k">def</span> <span class="nf">jql_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jql_script</span><span class="p">,</span> <span class="n">people_operation</span><span class="p">,</span> <span class="n">update_value</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">jql_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backup_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a JQL query to return a JSON array of objects that can then be used to dynamically construct People</span>
<span class="sd">            updates via the update_value</span>

<span class="sd">        :param jql_script: String containing a JQL script to run. The result should be an array of objects. Those</span>
<span class="sd">            objects should contain at least a $distinct_id key</span>
<span class="sd">        :param people_operation: A Mixpanel People update operation</span>
<span class="sd">        :param update_value: Can be a static value applied to all $distinct_ids or a user defined function or lambda</span>
<span class="sd">            that expects a dict containing at least a $distinct_id (or distinct_id) key, as its only parameter and</span>
<span class="sd">            returns the value to use for the update on that $distinct_id. The default is a lambda that returns the</span>
<span class="sd">            value at the dict&#39;s &#39;value&#39; key.</span>
<span class="sd">        :param jql_params: Optional dict that will be made available to the script as the params global variable.</span>
<span class="sd">            (Default value = None)</span>
<span class="sd">        :param ignore_alias: True or False (Default value = False)</span>
<span class="sd">        :param backup: True to create backup file otherwise False (default)</span>
<span class="sd">        :param backup_file: Optional filename to use for the backup file (Default value = None)</span>
<span class="sd">        :type jql_script: str</span>
<span class="sd">        :type people_operation: str</span>
<span class="sd">        :type jql_params: dict</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type backup: bool</span>
<span class="sd">        :type backup_file: str</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">jql_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_jql</span><span class="p">(</span><span class="n">jql_script</span><span class="p">,</span> <span class="n">jql_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backup_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">backup_file</span> <span class="o">=</span> <span class="s2">&quot;backup_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span>
            <span class="c1"># backs up ALL profiles, not just those affected by the JQL since jql_data might not contain full profiles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_people</span><span class="p">(</span><span class="n">backup_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">people_operation</span><span class="p">(</span><span class="n">people_operation</span><span class="p">,</span> <span class="n">update_value</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="n">jql_data</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span>
                                     <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.event_counts_to_people"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.event_counts_to_people">[docs]</a>    <span class="k">def</span> <span class="nf">event_counts_to_people</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the per user count of events in events list param as People properties</span>

<span class="sd">        :param from_date: A datetime or a date string of format YYYY-MM-DD to begin counting from</span>
<span class="sd">        :param events: A list of strings of event names to be counted</span>
<span class="sd">        :type from_date: datetime | str</span>
<span class="sd">        :type events: list[str]</span>
<span class="sd">        :return: Number of profiles operated on</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">jql_script</span> <span class="o">=</span> <span class="s2">&quot;function main() { var event_selectors_array = []; _.each(params.events, function(e) {&quot;</span> \
                     <span class="s2">&quot;event_selectors_array.push({&#39;event&#39;: e});}); return join(Events({from_date: params.from_date,&quot;</span> \
                     <span class="s2">&quot;to_date: params.to_date, event_selectors: event_selectors_array}), People(), {type: &#39;inner&#39;})&quot;</span> \
                     <span class="s2">&quot;.groupByUser([&#39;event.name&#39;], mixpanel.reducer.count()).map(function(row) {v = </span><span class="si">{}</span><span class="s2">; v[row.key[1]]&quot;</span> \
                     <span class="s2">&quot; = row.value; return {$distinct_id: row.key[0],value: v};});}&quot;</span>

        <span class="n">to_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
            <span class="n">from_date</span> <span class="o">=</span> <span class="n">from_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;from_date&#39;</span><span class="p">:</span> <span class="n">from_date</span><span class="p">,</span> <span class="s1">&#39;to_date&#39;</span><span class="p">:</span> <span class="n">to_date</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">events</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jql_operation</span><span class="p">(</span><span class="n">jql_script</span><span class="p">,</span> <span class="s1">&#39;$set&#39;</span><span class="p">,</span> <span class="n">jql_params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.export_jql_events"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.export_jql_events">[docs]</a>    <span class="k">def</span> <span class="nf">export_jql_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">event_selectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">timezone_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export events to disk via JQL. Optional whitelist of properties to include in the output.</span>

<span class="sd">        :param output_file: Name of the file to write to</span>
<span class="sd">        :param from_date: Date to export events from, can be a datetime object or str of form &#39;YYYY-MM-DD&#39;</span>
<span class="sd">        :param to_date: Date to export events to,, can be a datetime object or str of form &#39;YYYY-MM-DD&#39;</span>
<span class="sd">        :param event_selectors: A single event selector dict or a list of event selector dicts</span>
<span class="sd">        :param output_properties: A list of strings of property names to include in the output</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of export project timezone setting. If set, used to convert event</span>
<span class="sd">            timestamps from project time to UTC</span>
<span class="sd">        :param format: Data format for the output can be either &#39;json&#39; or &#39;csv&#39;</span>
<span class="sd">        :param compress: Optionally gzip the output</span>
<span class="sd">        :type output_file: str</span>
<span class="sd">        :type from_date: datetime | str</span>
<span class="sd">        :type to_date: datetime | str</span>
<span class="sd">        :type event_selectors: dict | list[dict]</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type output_properties: list[str]</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :type compress: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_jql_events</span><span class="p">(</span><span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span> <span class="n">event_selectors</span><span class="o">=</span><span class="n">event_selectors</span><span class="p">,</span>
                                       <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="n">output_properties</span><span class="p">,</span>
                                       <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_export_jql_items</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.export_jql_people"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.export_jql_people">[docs]</a>    <span class="k">def</span> <span class="nf">export_jql_people</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">user_selectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
                          <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export People profiles to disk via JQL by providing a single selector string or a list of selector dicts.</span>
<span class="sd">        Optional whitelist of properties to include in the output.</span>

<span class="sd">        :param output_file: Name of the file to write to</span>
<span class="sd">        :param user_selectors: A selector string or a list of selector dicts</span>
<span class="sd">        :param output_properties: A list of strings of property names to include in the output</span>
<span class="sd">        :param format: Data format for the output can be &#39;json&#39; or &#39;csv&#39;</span>
<span class="sd">        :param compress: Optionally gzip the output</span>
<span class="sd">        :type output_file: str</span>
<span class="sd">        :type user_selectors: str | list[dict]</span>
<span class="sd">        :type output_properties: list[str]</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :type compress: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">profiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_jql_people</span><span class="p">(</span><span class="n">user_selectors</span><span class="o">=</span><span class="n">user_selectors</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="n">output_properties</span><span class="p">,</span>
                                         <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_export_jql_items</span><span class="p">(</span><span class="n">profiles</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.query_jql_events"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.query_jql_events">[docs]</a>    <span class="k">def</span> <span class="nf">query_jql_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">event_selectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Query JQL for events. Optional whitelist of properties to include in the output.</span>

<span class="sd">        :param from_date: Date to export events from, can be a datetime object or str of form &#39;YYYY-MM-DD&#39;</span>
<span class="sd">        :param to_date: Date to export events to,, can be a datetime object or str of form &#39;YYYY-MM-DD&#39;</span>
<span class="sd">        :param event_selectors: A single event selector dict or a list of event selector dicts</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of export project timezone setting. If set, used to convert event</span>
<span class="sd">            timestamps from project time to UTC</span>
<span class="sd">        :param output_properties: A list of strings of property names to include in the output</span>
<span class="sd">        :param format: Data format for the output can be either &#39;json&#39; or &#39;csv&#39;</span>
<span class="sd">        :type from_date: datetime | str</span>
<span class="sd">        :type to_date: datetime | str</span>
<span class="sd">        :type event_selectors: dict | list[dict]</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type output_properties: list[str]</span>
<span class="sd">        :type format: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_jql_items</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span> <span class="n">event_selectors</span><span class="o">=</span><span class="n">event_selectors</span><span class="p">,</span>
                                     <span class="n">output_properties</span><span class="o">=</span><span class="n">output_properties</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span>
                                     <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.query_jql_people"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.query_jql_people">[docs]</a>    <span class="k">def</span> <span class="nf">query_jql_people</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_selectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Query JQL for profiles by providing a single selector string or a list of selector dicts.</span>
<span class="sd">        Optional whitelist of properties to include in the output.</span>


<span class="sd">        :param user_selectors: A selector string or a list of selector dicts</span>
<span class="sd">        :param output_properties: A list of strings of property names to include in the output</span>
<span class="sd">        :param format: Data format for the output can be &#39;json&#39; or &#39;csv&#39;</span>
<span class="sd">        :type user_selectors: str | list[dict]</span>
<span class="sd">        :type output_properties: list[str]</span>
<span class="sd">        :type format: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_jql_items</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="n">user_selectors</span><span class="o">=</span><span class="n">user_selectors</span><span class="p">,</span> <span class="n">output_properties</span><span class="o">=</span><span class="n">output_properties</span><span class="p">,</span>
                                     <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.query_export"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.query_export">[docs]</a>    <span class="k">def</span> <span class="nf">query_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">add_gzip_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">raw_stream</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Queries the /export API and returns a list of Mixpanel event dicts</span>

<span class="sd">        https://mixpanel.com/help/reference/exporting-raw-data#export-api-reference</span>

<span class="sd">        :param params: Parameters to use for the /export API request</span>
<span class="sd">        :param add_gzip_header: Adds &#39;Accept-encoding: gzip&#39; to the request headers (Default value = False)</span>
<span class="sd">        :param raw_stream: Returns the raw file-like response directly from urlopen instead of creating a list</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :type add_gzip_header: bool</span>
<span class="sd">        :type raw_stream: bool</span>
<span class="sd">        :return: A list of Mixpanel event dicts</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">add_gzip_header</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Accept-encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip&#39;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">RAW_API</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">raw_stream</span><span class="o">=</span><span class="n">raw_stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raw_stream</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error querying /export API&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">file_like_object</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="p">:</span>
                    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">events</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;/export API response empty&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Mixpanel.query_engage"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.query_engage">[docs]</a>    <span class="k">def</span> <span class="nf">query_engage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Queries the /engage API and returns a list of Mixpanel People profile dicts</span>

<span class="sd">        https://mixpanel.com/help/reference/data-export-api#people-analytics</span>

<span class="sd">        :param params: Parameters to use for the /engage API request. Defaults to returning all profiles.</span>
<span class="sd">            (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :raise RuntimeError: Raises Runtime error if params include behaviors and timezone_offset is None</span>
<span class="sd">        :return: A list of Mixpanel People profile dicts</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;behaviors&#39;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="n">timezone_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;timezone_offset required if params include behaviors&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;behaviors&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;as_of_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="p">(</span><span class="n">timezone_offset</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">))</span>

        <span class="n">engage_paginator</span> <span class="o">=</span> <span class="n">ConcurrentPaginator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_engage_page</span><span class="p">,</span> <span class="n">concurrency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_pool_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">engage_paginator</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.export_events"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.export_events">[docs]</a>    <span class="k">def</span> <span class="nf">export_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_gzip_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">request_per_day</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">raw_stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Queries the /export API and writes the Mixpanel event data to disk as a JSON or CSV file. Optionally gzip file.</span>

<span class="sd">        https://mixpanel.com/help/reference/exporting-raw-data#export-api-reference</span>

<span class="sd">        :param output_file: Name of the file to write to</span>
<span class="sd">        :param params: Parameters to use for the /export API request</span>
<span class="sd">        :param format: Can be either &#39;json&#39; or &#39;csv&#39; (Default value = &#39;json&#39;)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of export project timezone setting. If set, used to convert event</span>
<span class="sd">            timestamps from project time to UTC</span>
<span class="sd">        :param add_gzip_header: Adds &#39;Accept-encoding: gzip&#39; to the request headers (Default value = False)</span>
<span class="sd">        :param compress: Option to gzip output_file (Default value = False)</span>
<span class="sd">        :param request_per_day: Option to make one API request (and output file) per day in the exported date range</span>
<span class="sd">            (Default value = False)</span>
<span class="sd">        :param raw_stream: Option to stream the newline delimited JSON response directly to output_file. If True, format</span>
<span class="sd">            , timezone_offset and compress arguments are ignored (Default value = False)</span>
<span class="sd">        :param buffer_size: Buffer size in bytes to use if raw_stream is True (Default value = 1024)</span>
<span class="sd">        :type output_file: str</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type add_gzip_header: bool</span>
<span class="sd">        :type compress: bool</span>
<span class="sd">        :type request_per_day: bool</span>
<span class="sd">        :type raw_stream: bool</span>
<span class="sd">        :type buffer_size: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Increase timeout to 20 minutes if it&#39;s still set to default, /export requests can take a long time</span>
        <span class="n">timeout_backup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">==</span> <span class="mi">120</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">1200</span>

        <span class="n">request_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">request_per_day</span><span class="p">:</span>
            <span class="n">date_format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;from_date&#39;</span><span class="p">],</span> <span class="n">date_format</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;to_date&#39;</span><span class="p">],</span> <span class="n">date_format</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">f</span>
            <span class="n">request_count</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">days</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">request_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">params_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">current_file</span> <span class="o">=</span> <span class="n">output_file</span>

            <span class="k">if</span> <span class="n">request_per_day</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;from_date&#39;</span><span class="p">],</span> <span class="n">date_format</span><span class="p">)</span>
                <span class="n">current_day</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                    <span class="n">date_format</span><span class="p">)</span>
                <span class="n">file_components</span> <span class="o">=</span> <span class="n">output_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">current_day</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">current_file</span> <span class="o">=</span> <span class="n">current_file</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">file_components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">params_copy</span><span class="p">[</span><span class="s1">&#39;from_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_day</span>
                <span class="n">params_copy</span><span class="p">[</span><span class="s1">&#39;to_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_day</span>

            <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_export</span><span class="p">(</span><span class="n">params_copy</span><span class="p">,</span> <span class="n">add_gzip_header</span><span class="o">=</span><span class="n">add_gzip_header</span><span class="p">,</span> <span class="n">raw_stream</span><span class="o">=</span><span class="n">raw_stream</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">raw_stream</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">add_gzip_header</span> <span class="ow">and</span> <span class="n">current_file</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;.gz&#39;</span><span class="p">:</span>
                    <span class="n">current_file</span> <span class="o">=</span> <span class="n">current_file</span> <span class="o">+</span> <span class="s1">&#39;.gz&#39;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">current_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">timezone_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Convert timezone_offset from hours to seconds</span>
                    <span class="n">timezone_offset</span> <span class="o">=</span> <span class="n">timezone_offset</span> <span class="o">*</span> <span class="mi">3600</span>
                    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
                        <span class="n">event</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timezone_offset</span><span class="p">)</span>

                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">current_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">)</span>

        <span class="c1"># If we modified the default timeout above, restore default setting</span>
        <span class="k">if</span> <span class="n">timeout_backup</span> <span class="o">==</span> <span class="mi">120</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout_backup</span></div>

<div class="viewcode-block" id="Mixpanel.export_people"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.export_people">[docs]</a>    <span class="k">def</span> <span class="nf">export_people</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Queries the /engage API and writes the Mixpanel People profile data to disk as a JSON or CSV file. Optionally</span>
<span class="sd">        gzip file.</span>

<span class="sd">        https://mixpanel.com/help/reference/data-export-api#people-analytics</span>

<span class="sd">        :param output_file: Name of the file to write to</span>
<span class="sd">        :param params: Parameters to use for the /engage API request (Default value = None)</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of project timezone setting, used to calculate as_of_timestamp</span>
<span class="sd">            parameter for queries that use behaviors. Required if query_params contains behaviors (Default value = None)</span>
<span class="sd">        :param format:  (Default value = &#39;json&#39;)</span>
<span class="sd">        :param compress:  (Default value = False)</span>
<span class="sd">        :type output_file: str</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :type compress: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">profiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_engage</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">)</span>
        <span class="n">Mixpanel</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">profiles</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.import_events"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.import_events">[docs]</a>    <span class="k">def</span> <span class="nf">import_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="p">,</span> <span class="n">dataset_version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Imports a list of Mixpanel event dicts or a file containing a JSON array of Mixpanel events.</span>

<span class="sd">        https://mixpanel.com/help/reference/importing-old-events</span>

<span class="sd">        :param data: A list of Mixpanel event dicts or the name of a file containing a JSON array or CSV of Mixpanel</span>
<span class="sd">            events</span>
<span class="sd">        :param timezone_offset: UTC offset (number of hours) for the project that exported the data. Used to convert the</span>
<span class="sd">            event timestamps back to UTC prior to import.</span>
<span class="sd">        :param dataset_version: Dataset version to import into, required if self.dataset_id is set, otherwise</span>
<span class="sd">            optional</span>
<span class="sd">        :type data: list | str</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type dataset_version: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="ow">or</span> <span class="n">dataset_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="ow">and</span> <span class="n">dataset_version</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;import-events&#39;</span>
                <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETA_IMPORT_API</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Must supply both, dataset_version and dataset_id in init, or neither!&#39;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;import&#39;</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMPORT_API</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="n">timezone_offset</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
                          <span class="n">dataset_version</span><span class="o">=</span><span class="n">dataset_version</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.import_people"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.import_people">[docs]</a>    <span class="k">def</span> <span class="nf">import_people</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dataset_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_record_import</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Imports a list of Mixpanel People profile dicts (or raw API update operations) or a file containing a JSON</span>
<span class="sd">            array or CSV of Mixpanel People profiles (or raw API update operations).</span>

<span class="sd">            https://mixpanel.com/help/reference/http#people-analytics-updates</span>

<span class="sd">        :param data: A list of Mixpanel People profile dicts (or /engage API update operations) or the name of a file</span>
<span class="sd">            containing a JSON array of Mixpanel People profiles (or /engage API update operations).</span>
<span class="sd">        :param ignore_alias: Option to bypass Mixpanel&#39;s alias lookup table (Default value = False)</span>
<span class="sd">        :param dataset_version: Dataset version to import into, required if self.dataset_id is set, otherwise</span>
<span class="sd">            optional</span>
<span class="sd">        :param raw_record_import: Set this to True if data is a list of API update operations (Default value = False)</span>
<span class="sd">        :type data: list | str</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type dataset_version: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="ow">or</span> <span class="n">dataset_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="ow">and</span> <span class="n">dataset_version</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;import-people&#39;</span>
                <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETA_IMPORT_API</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Must supply both, dataset_version and dataset_id in init, or neither!&#39;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;engage&#39;</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMPORT_API</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="n">ignore_alias</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
                          <span class="n">dataset_version</span><span class="o">=</span><span class="n">dataset_version</span><span class="p">,</span> <span class="n">raw_record_import</span><span class="o">=</span><span class="n">raw_record_import</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.list_all_dataset_versions"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.list_all_dataset_versions">[docs]</a>    <span class="k">def</span> <span class="nf">list_all_dataset_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of all dataset version objects for the current dataset_id</span>

<span class="sd">        :return: A list of dataset version objects</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="s1">&#39;dataset_id required!&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets_request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">versions_request</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.create_dataset_version"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.create_dataset_version">[docs]</a>    <span class="k">def</span> <span class="nf">create_dataset_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new dataset version for the current dataset_id. Note that dataset_id must already exist!</span>

<span class="sd">        :return: Returns a dataset version object. This version of the dataset is writable by default while the ready</span>
<span class="sd">            and readable flags in the version state are false.</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="s1">&#39;dataset_id required!&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets_request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">versions_request</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.update_dataset_version"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.update_dataset_version">[docs]</a>    <span class="k">def</span> <span class="nf">update_dataset_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates a specific version_id for the current dataset_id. Currently, users can only update the state</span>
<span class="sd">            of a given dataset version. Only the readable and writable boolean fields can be updated.</span>

<span class="sd">        :param version_id: version_id of the version to be updated</span>
<span class="sd">        :param state: State object with fields to be updated</span>
<span class="sd">        :type version_id: str</span>
<span class="sd">        :type state: dict</span>
<span class="sd">        :return: True for success, False otherwise.</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="s1">&#39;dataset_id required!&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;writable&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">,</span> <span class="s1">&#39;state must specify writable field!&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;readable&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">,</span> <span class="s1">&#39;state must specify readable field!&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets_request</span><span class="p">(</span><span class="s1">&#39;PATCH&#39;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">versions_request</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">version_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.mark_dataset_version_readable"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.mark_dataset_version_readable">[docs]</a>    <span class="k">def</span> <span class="nf">mark_dataset_version_readable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the readable field of the specified version_id&#39;s state to true for the current dataset_id</span>

<span class="sd">        :param version_id: version_id of the version to be marked readable</span>
<span class="sd">        :type version_id: str</span>
<span class="sd">        :return: True for success, False otherwise.</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Fetching current version...&#39;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_version</span><span class="p">(</span><span class="n">version_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">in</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">writable</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">][</span><span class="s1">&#39;writable&#39;</span><span class="p">]</span>
            <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;writable&#39;</span><span class="p">:</span> <span class="n">writable</span><span class="p">,</span> <span class="s1">&#39;readable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Updating state with: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset_version</span><span class="p">(</span><span class="n">version_id</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Failed to get dataset version object for version_id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">version_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;of dataset &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Mixpanel.delete_dataset_version"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.delete_dataset_version">[docs]</a>    <span class="k">def</span> <span class="nf">delete_dataset_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the version with version_id of the current dataset_id</span>

<span class="sd">        :param version_id: version_id of the version to be deleted</span>
<span class="sd">        :type version_id: str</span>
<span class="sd">        :return: True for success, False otherwise.</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="s1">&#39;dataset_id required!&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets_request</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">versions_request</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">version_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.list_dataset_version"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.list_dataset_version">[docs]</a>    <span class="k">def</span> <span class="nf">list_dataset_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the dataset version object with the specified version_id for the current dataset_id</span>

<span class="sd">        :param version_id: version_id of the dataset version object to return</span>
<span class="sd">        :type version_id: str</span>
<span class="sd">        :return: Returns a dataset version object</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="s1">&#39;dataset_id required!&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasets_request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">versions_request</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">version_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel.wait_until_dataset_version_ready"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel.wait_until_dataset_version_ready">[docs]</a>    <span class="k">def</span> <span class="nf">wait_until_dataset_version_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Polls the ready state of the specified version_id for the current dataset_id every 60 seconds until it&#39;s True</span>

<span class="sd">        :param version_id: version_id of the dataset_version to check if ready</span>
<span class="sd">        :type version_id: str</span>
<span class="sd">        :return: Returns True once the dataset version&#39;s ready field is true. Returns False if the dataset version isn&#39;t</span>
<span class="sd">            found</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">ready</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Waiting...&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_version</span><span class="p">(</span><span class="n">version_id</span><span class="p">)</span>
            <span class="n">attempt</span> <span class="o">=</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">in</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">ready</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">][</span><span class="s1">&#39;ready&#39;</span><span class="p">]</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Attempt #&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: ready = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ready</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Failed to get dataset version object for version_id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">version_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;of dataset &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Private, internal methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._unicode_urlencode"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._unicode_urlencode">[docs]</a>    <span class="k">def</span> <span class="nf">_unicode_urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;URL encodes a dict of Mixpanel parameters</span>

<span class="sd">        :param params: A dict containing Mixpanel parameter names and values</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :return: A URL encoded string</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]),)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._response_handler_callback"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._response_handler_callback">[docs]</a>    <span class="k">def</span> <span class="nf">_response_handler_callback</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes a Mixpanel API response and checks the status</span>

<span class="sd">        :param response: A Mixpanel API JSON response</span>
<span class="sd">        :type response: str</span>
<span class="sd">        :raises RuntimeError: Raises RuntimeError if status is not equal to 1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">response_data</span> <span class="ow">and</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_data</span><span class="p">):</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Bad API response: &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Import or Update Failed&#39;</span><span class="p">)</span>
        <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;API Response: &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._write_items_to_csv"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._write_items_to_csv">[docs]</a>    <span class="k">def</span> <span class="nf">_write_items_to_csv</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes a list of Mixpanel events or profiles to a csv file</span>

<span class="sd">        :param items: A list of Mixpanel events or profiles</span>
<span class="sd">        :param output_file: A string containing the path and filename to write to</span>
<span class="sd">        :type items: list</span>
<span class="sd">        :type output_file: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine whether the items are profiles or events based on the presence of a $distinct_id key</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;$distinct_id&#39;</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">props_key</span> <span class="o">=</span> <span class="s1">&#39;$properties&#39;</span>
                <span class="n">initial_header_value</span> <span class="o">=</span> <span class="s1">&#39;$distinct_id&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">props_key</span> <span class="o">=</span> <span class="s1">&#39;properties&#39;</span>
                <span class="n">initial_header_value</span> <span class="o">=</span> <span class="s1">&#39;event&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No data to write!&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="n">props_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="n">subkeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">column</span> <span class="k">for</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>
        <span class="n">subkeys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">subkeys</span><span class="p">)</span>

        <span class="c1"># Create the header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_header_value</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">subkeys</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

        <span class="c1"># Create the writer and write the header</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="n">initial_header_value</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">subkey</span> <span class="ow">in</span> <span class="n">subkeys</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="n">props_key</span><span class="p">][</span><span class="n">subkey</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">props_key</span><span class="p">][</span><span class="n">subkey</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._properties_from_csv_row"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._properties_from_csv_row">[docs]</a>    <span class="k">def</span> <span class="nf">_properties_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ignored_columns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a row from a csv file into a properties dict</span>

<span class="sd">        :param row: A list containing the csv row data</span>
<span class="sd">        :param header: A list containing the column headers (property names)</span>
<span class="sd">        :param ignored_columns: A list of columns (properties) to exclude</span>
<span class="sd">        :type row: list</span>
<span class="sd">        :type header: list</span>
<span class="sd">        :type ignored_columns: list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
            <span class="c1"># Handle a strange edge case where the length of the row is longer than the length of the header.</span>
            <span class="c1"># We do this to prevent an out of range error.</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">ignored_columns</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># We use literal_eval() here to de-stringify numbers, lists and objects in the CSV data</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">props</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._event_object_from_csv_row"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._event_object_from_csv_row">[docs]</a>    <span class="k">def</span> <span class="nf">_event_object_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">event_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distinct_id_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">time_converter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a row from a csv file into a Mixpanel event dict</span>

<span class="sd">        :param row: A list containing the Mixpanel event data from a csv row</span>
<span class="sd">        :param header: A list containing the csv column headers</span>
<span class="sd">        :param event_index: Index of the event name in row list, if None this method will determine the index</span>
<span class="sd">            (Default value = None)</span>
<span class="sd">        :param distinct_id_index: Index of the distinct_id in row list, if None this method will determine the index</span>
<span class="sd">            (Default value = None)</span>
<span class="sd">        :param time_index: Index of the time property in row list, if None this method will determine the index</span>
<span class="sd">            (Default value = None)</span>
<span class="sd">        :param time_converter: A function to convert the value at time_index into a Unix epoch timestamp int in seconds</span>
<span class="sd">        :type row: list</span>
<span class="sd">        :type header: list</span>
<span class="sd">        :type event_index: int</span>
<span class="sd">        :type distinct_id_index: int</span>
<span class="sd">        :type time_index: int</span>
<span class="sd">        :type time_converter: (value) -&gt; int</span>
<span class="sd">        :return: A Mixpanel event object</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">event_index</span><span class="p">)</span>
        <span class="n">distinct_id_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;distinct_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">distinct_id_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">distinct_id_index</span><span class="p">)</span>
        <span class="n">time_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">time_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time_index</span><span class="p">)</span>
        <span class="n">time_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">time_converter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time_converter</span><span class="p">(</span><span class="n">time_value</span><span class="p">))</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;distinct_id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">distinct_id_index</span><span class="p">],</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">}</span>
        <span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">_properties_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;distinct_id&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]))</span>
        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">event_index</span><span class="p">],</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">props</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">event</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._people_object_from_csv_row"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._people_object_from_csv_row">[docs]</a>    <span class="k">def</span> <span class="nf">_people_object_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">distinct_id_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a row from a csv file into a Mixpanel People profile dict</span>

<span class="sd">        :param row: A list containing the Mixpanel event data from a csv row</span>
<span class="sd">        :param header: A list containing the csv column headers</span>
<span class="sd">        :param distinct_id_index: Index of the distinct_id in row list, if None this method will determine the index</span>
<span class="sd">            (Default value = None)</span>
<span class="sd">        :type row: list</span>
<span class="sd">        :type header: list</span>
<span class="sd">        :type distinct_id_index: int</span>
<span class="sd">        :return: A Mixpanel People profile object</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">distinct_id_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;$distinct_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">distinct_id_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">distinct_id_index</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_properties_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">])</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">distinct_id_index</span><span class="p">],</span> <span class="s1">&#39;$properties&#39;</span><span class="p">:</span> <span class="n">props</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">profile</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._list_from_argument"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._list_from_argument">[docs]</a>    <span class="k">def</span> <span class="nf">_list_from_argument</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list given a string with the path to file of Mixpanel data or an existing list</span>

<span class="sd">        :param arg: A string file path or a list</span>
<span class="sd">        :type arg: list | str</span>
<span class="sd">        :return: A list of Mixpanel events or profiles</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">item_list</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_list_from_items_filename</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">item_list</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;data parameter must be a string filename or a list of items&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item_list</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._list_from_items_filename"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._list_from_items_filename">[docs]</a>    <span class="k">def</span> <span class="nf">_list_from_items_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of Mixpanel events or profiles given the path to a file containing such data</span>

<span class="sd">        :param filename: Path to a file containing a JSON array of Mixpanel event or People profile data</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        :return: A list of Mixpanel events or profiles</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rbU&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">item_file</span><span class="p">:</span>
                <span class="c1"># First try loading it as a JSON list</span>
                <span class="n">item_list</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">item_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="s1">&#39;No JSON object could be decoded&#39;</span><span class="p">:</span>
                <span class="c1"># Based on the error message, try to treat it as CSV</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rbU&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">item_file</span><span class="p">:</span>
                    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">item_file</span><span class="p">,</span> <span class="p">)</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                    <span class="c1"># Determine if the data is events or profiles based on keys in the header.</span>
                    <span class="c1"># NOTE: this will fail if it were profile data with a people property named &#39;event&#39;</span>
                    <span class="k">if</span> <span class="s1">&#39;event&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                        <span class="n">event_index</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">)</span>
                        <span class="n">distinct_id_index</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;distinct_id&quot;</span><span class="p">)</span>
                        <span class="n">time_index</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                            <span class="n">event</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_event_object_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">event_index</span><span class="p">,</span> <span class="n">distinct_id_index</span><span class="p">,</span>
                                                                        <span class="n">time_index</span><span class="p">)</span>
                            <span class="n">item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s1">&#39;$distinct_id&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                        <span class="n">distinct_id_index</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;$distinct_id&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                            <span class="n">profile</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_people_object_from_csv_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">distinct_id_index</span><span class="p">)</span>
                            <span class="n">item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Unable to determine Mixpanel data type: CSV header does not contain &#39;event&#39; or &#39;$distinct_id&#39;&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Try treating the file as newline delimited JSON objects</span>
                <span class="n">item_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rbU&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">item_file</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_file</span><span class="p">:</span>
                        <span class="n">item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error loading data from file: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item_list</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._gzip_file"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._gzip_file">[docs]</a>    <span class="k">def</span> <span class="nf">_gzip_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gzip an existing file</span>

<span class="sd">        :param filename: Path to a file to be gzipped</span>
<span class="sd">        :type filename: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gzip_filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.gz&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">,</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gzip_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._prep_event_for_import"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._prep_event_for_import">[docs]</a>    <span class="k">def</span> <span class="nf">_prep_event_for_import</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes an event dict and modifies it to meet the Mixpanel /import HTTP spec or dumps it to disk if it is invalid</span>

<span class="sd">        :param event: A Mixpanel event dict</span>
<span class="sd">        :param token: A Mixpanel project token</span>
<span class="sd">        :param timezone_offset: UTC offset (number of hours) of the timezone setting for the project that exported the</span>
<span class="sd">            data. Needed to convert the timestamp back to UTC prior to import.</span>
<span class="sd">        :type event: dict</span>
<span class="sd">        :type token: str</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :return: Mixpanel event dict with token added and timestamp adjusted to UTC</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The /import API requires a &#39;time&#39; and &#39;distinct_id&#39; property, if either of those are missing we dump that</span>
        <span class="c1"># event to a log of invalid events and return</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;distinct_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]):</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Event missing time or distinct_id property, dumping to invalid_events.txt&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;invalid_events.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">invalid</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">invalid</span><span class="p">)</span>
                <span class="n">invalid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="n">event_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># transforms timestamp to UTC</span>
        <span class="n">event_copy</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">timezone_offset</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">))</span>
        <span class="n">event_copy</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
        <span class="k">return</span> <span class="n">event_copy</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._prep_params_for_profile"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._prep_params_for_profile">[docs]</a>    <span class="k">def</span> <span class="nf">_prep_params_for_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes a People profile dict and returns the parameters for an /engage API update</span>

<span class="sd">        :param profile: A Mixpanel People profile dict</span>
<span class="sd">        :param token: A Mixpanel project token</span>
<span class="sd">        :param operation: A Mixpanel /engage API update operation</span>
<span class="sd">            https://mixpanel.com/help/reference/http#update-operations</span>
<span class="sd">        :param value: The value to use for the operation or a function that takes a People profile and returns the value</span>
<span class="sd">            to use</span>
<span class="sd">        :param ignore_alias: Option to bypass Mixpanel&#39;s alias lookup table</span>
<span class="sd">        :param dynamic: Should be set to True if value param is a function, otherwise false.</span>
<span class="sd">        :type profile: dict</span>
<span class="sd">        :type token: str</span>
<span class="sd">        :type value: dict | list | str | (profile) -&gt; dict | (profile) -&gt; list</span>
<span class="sd">        :type operation: str</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type dynamic: bool</span>
<span class="sd">        :return: Parameters for a Mixpanel /engage API update</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We use a dynamic flag parameter to avoid the overhead of checking the value parameter&#39;s type every time</span>
        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">op_value</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">op_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;$ignore_time&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;$ip&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;$ignore_alias&#39;</span><span class="p">:</span> <span class="n">ignore_alias</span><span class="p">,</span>
            <span class="s1">&#39;$token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
            <span class="n">operation</span><span class="p">:</span> <span class="n">op_value</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If there&#39;s no $distinct_id, look for distinct_id instead (could be JQL data)</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;$distinct_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;distinct_id&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Profile object does not contain a distinct id, skipping.&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">return</span> <span class="n">params</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._dt_from_iso"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._dt_from_iso">[docs]</a>    <span class="k">def</span> <span class="nf">_dt_from_iso</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes a Mixpanel People profile and returns a datetime object for the $last_seen value or datetime.min if</span>
<span class="sd">        $last_seen is not set</span>

<span class="sd">        :param profile: A Mixpanel People profile dict</span>
<span class="sd">        :type profile: dict</span>
<span class="sd">        :return: A datetime representing the $last_seen value for the given profile</span>
<span class="sd">        :rtype: datetime</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">min</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">last_seen</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;$properties&quot;</span><span class="p">][</span><span class="s2">&quot;$last_seen&quot;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try to use the MUCH faster ciso8601 library, if it&#39;s not installed use the built-in datetime library</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">ciso8601</span><span class="o">.</span><span class="n">parse_datetime_unaware</span><span class="p">(</span><span class="n">last_seen</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">last_seen</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dt</span>
        <span class="k">return</span> <span class="n">dt</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Mixpanel._export_jql_items"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._export_jql_items">[docs]</a>    <span class="k">def</span> <span class="nf">_export_jql_items</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Based method for exporting jql events or jql people to disk</span>

<span class="sd">        :param items: json list or csv data</span>
<span class="sd">        :param output_file: Name of the file to write to</span>
<span class="sd">        :param format: Data format for the output can be &#39;json&#39; or &#39;csv&#39;, should match the data type in items</span>
<span class="sd">        :param compress: Optionally gzip the output file</span>
<span class="sd">        :type items: list | str</span>
<span class="sd">        :type output_file: str</span>
<span class="sd">        :type format: str</span>
<span class="sd">        :type compress: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_gzip_file</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Invalid format must be either json or csv, got: &#39;</span> <span class="o">+</span> <span class="nb">format</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="Mixpanel._get_engage_page"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._get_engage_page">[docs]</a>    <span class="k">def</span> <span class="nf">_get_engage_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches and returns the response from an /engage request</span>

<span class="sd">        :param params: Query parameters for the /engage API</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :return: /engage API response object</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">FORMATTED_API</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;engage&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;results&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Invalid response from /engage: &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="Mixpanel._dispatch_batches"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._dispatch_batches">[docs]</a>    <span class="k">def</span> <span class="nf">_dispatch_batches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">item_list</span><span class="p">,</span> <span class="n">prep_args</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset_version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Asynchronously sends batches of items to the /import, /engage, /import-events or /import-people Mixpanel API</span>
<span class="sd">        endpoints</span>

<span class="sd">        :param base_url: The base API url</span>
<span class="sd">        :param endpoint: Can be &#39;import&#39;, &#39;engage&#39;, &#39;/import-events&#39; or &#39;/import-people&#39;</span>
<span class="sd">        :param item_list: List of Mixpanel event data or People updates</span>
<span class="sd">        :param prep_args: List of arguments to be provided to the appropriate _prep method in addition to the profile or</span>
<span class="sd">            event</span>
<span class="sd">        :param dataset_id: Dataset name to import into, required if dataset_version is specified, otherwise optional</span>
<span class="sd">        :param dataset_version: Dataset version to import into, required if dataset_id is specified, otherwise</span>
<span class="sd">            optional</span>
<span class="sd">        :type base_url: str</span>
<span class="sd">        :type endpoint: str</span>
<span class="sd">        :type item_list: list</span>
<span class="sd">        :type prep_args: list</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :type dataset_version: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">ThreadPool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pool_size</span><span class="p">)</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Decide which _prep function to use based on the endpoint</span>
        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;import&#39;</span> <span class="ow">or</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;import-events&#39;</span><span class="p">:</span>
            <span class="n">prep_function</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_prep_event_for_import</span>
        <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;engage&#39;</span> <span class="ow">or</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;import-people&#39;</span><span class="p">:</span>
            <span class="n">prep_function</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_prep_params_for_profile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;endpoint must be &quot;import&quot;, &quot;engage&quot;, &quot;import-events&quot; or &quot;import-people&quot;, found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">base_url</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETA_IMPORT_API</span><span class="p">:</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prep_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Insert the given item as the first argument to be passed to the _prep function determined above</span>
                <span class="n">prep_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">prep_function</span><span class="p">(</span><span class="o">*</span><span class="n">prep_args</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                    <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">==</span> <span class="n">batch_size</span><span class="p">:</span>
                <span class="c1"># Add an asynchronous call to _send_batch to the thread pool</span>
                <span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_batch</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">dataset_version</span><span class="p">),</span>
                                 <span class="n">callback</span><span class="o">=</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">_response_handler_callback</span><span class="p">)</span>
                <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># If there are fewer than batch_size updates left ensure one last call is made</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
            <span class="c1"># Add an asynchronous call to _send_batch to the thread pool</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_batch</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">dataset_version</span><span class="p">),</span>
                             <span class="n">callback</span><span class="o">=</span><span class="n">Mixpanel</span><span class="o">.</span><span class="n">_response_handler_callback</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mixpanel._send_batch"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._send_batch">[docs]</a>    <span class="k">def</span> <span class="nf">_send_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;POST a single batch of data to a Mixpanel API and return the response</span>

<span class="sd">        :param base_url: The base API url</span>
<span class="sd">        :param endpoint: Can be &#39;import&#39;, &#39;engage&#39;, &#39;import-events&#39; or &#39;import-people&#39;</span>
<span class="sd">        :param batch: List of Mixpanel event data or People updates to import.</span>
<span class="sd">        :param dataset_id: Dataset name to import into, required if dataset_version is specified, otherwise optional</span>
<span class="sd">        :param dataset_version: Dataset version to import into, required if dataset_id is specified, otherwise</span>
<span class="sd">            optional</span>
<span class="sd">        :param retries:  Max number of times to retry if we get a HTTP 5xx response (Default value = 0)</span>
<span class="sd">        :type base_url: str</span>
<span class="sd">        :type endpoint: str</span>
<span class="sd">        :type batch: list</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :type dataset_version: str</span>
<span class="sd">        :type retries: int</span>
<span class="sd">        :return: HTTP response from Mixpanel API</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">batch</span><span class="p">))}</span>
            <span class="k">if</span> <span class="n">dataset_id</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dataset_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_id</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span>
            <span class="k">if</span> <span class="n">dataset_version</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dataset_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_version</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="p">[</span><span class="n">endpoint</span><span class="p">],</span> <span class="n">params</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Sent &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; items on &quot;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to import batch, dumping to file import_backup.txt&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;import_backup.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">backup</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">backup</span><span class="p">)</span>
                <span class="n">backup</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel._import_data"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._import_data">[docs]</a>    <span class="k">def</span> <span class="nf">_import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">dataset_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_record_import</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base method to import either event data or People profile data as a list of dicts or from a JSON array</span>
<span class="sd">        file</span>

<span class="sd">        :param data: A list of event or People profile dicts or the name of a file containing a JSON array or CSV of</span>
<span class="sd">            events or People profiles</span>
<span class="sd">        :param endpoint: can be &#39;import&#39; or &#39;engage&#39;</span>
<span class="sd">        :param timezone_offset: UTC offset (number of hours) for the project that exported the data. Used to convert the</span>
<span class="sd">            event timestamps back to UTC prior to import. (Default value = 0)</span>
<span class="sd">        :param ignore_alias: Option to bypass Mixpanel&#39;s alias lookup table (Default value = False)</span>
<span class="sd">        :param dataset_id: Dataset name to import into, required if dataset_version is specified, otherwise optional</span>
<span class="sd">        :param dataset_version: Dataset version to import into, required if dataset_id is specified, otherwise</span>
<span class="sd">            optional</span>
<span class="sd">        :param raw_record_import: Set this to True if data is a list of People update operations</span>
<span class="sd">        :type data: list | str</span>
<span class="sd">        :type endpoint: str</span>
<span class="sd">        :type timezone_offset: int | float</span>
<span class="sd">        :type ignore_alias: bool</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :type dataset_version: str</span>
<span class="sd">        :type raw_record_import: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot;Project token required for import!&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="ow">or</span> <span class="n">dataset_version</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dataset_id</span> <span class="ow">and</span> <span class="n">dataset_version</span><span class="p">):</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Both dataset_id AND dataset_version are required&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Create a list of arguments to be used in one of the _prep functions later</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">]</span>

        <span class="n">item_list</span> <span class="o">=</span> <span class="n">Mixpanel</span><span class="o">.</span><span class="n">_list_from_argument</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw_record_import</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;import&#39;</span> <span class="ow">or</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;import-events&#39;</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timezone_offset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;engage&#39;</span> <span class="ow">or</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;import-people&#39;</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;$set&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">profile</span><span class="p">:</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;$properties&#39;</span><span class="p">],</span> <span class="n">ignore_alias</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_batches</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">item_list</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset_id</span><span class="p">,</span>
                               <span class="n">dataset_version</span><span class="o">=</span><span class="n">dataset_version</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel._query_jql_items"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._query_jql_items">[docs]</a>    <span class="k">def</span> <span class="nf">_query_jql_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_selectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_selectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">output_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base method for querying jql for events or People</span>

<span class="sd">        :param data_type: Can be either &#39;users&#39; or &#39;people&#39;</span>
<span class="sd">        :param from_date: Date to query events from, can be a datetime object or str of form &#39;YYYY-MM-DD&#39;. Only used</span>
<span class="sd">            when data_type=&#39;events&#39;</span>
<span class="sd">        :param to_date: Date to query events to, can be a datetime object or str of form &#39;YYYY-MM-DD&#39;. Only used when</span>
<span class="sd">            data_type=&#39;events&#39;</span>
<span class="sd">        :param event_selectors: A single event selector dict or a list of event selector dicts. Only used when</span>
<span class="sd">            data_type=&#39;events</span>
<span class="sd">        :param user_selectors: A selector string or a list of selector dicts. Only used when data_type=&#39;people&#39;</span>
<span class="sd">        :param output_properties:  A list of strings of property names to include in the output</span>
<span class="sd">        :param timezone_offset: UTC offset in hours of export project timezone setting. If set, used to convert event</span>
<span class="sd">            timestamps from project time to UTC. Only used when data_type=&#39;events&#39;</span>
<span class="sd">        :param format: Data format for the output can be either &#39;json&#39; or &#39;csv&#39;</span>
<span class="sd">        :type data_type: str</span>
<span class="sd">        :type from_date: datetime | str</span>
<span class="sd">        :type to_date: datetime | str</span>
<span class="sd">        :type event_selectors: dict | list[dict]</span>
<span class="sd">        :type user_selectors: str | list[dict]</span>
<span class="sd">        :type output_properties: list[str]</span>
<span class="sd">        :type timezone_offset: float | int</span>
<span class="sd">        :type format: str</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;events&#39;</span><span class="p">:</span>
            <span class="n">jql_script</span> <span class="o">=</span> <span class="s2">&quot;function main() {return Events({from_date: params.from_date,to_date: params.to_date,&quot;</span> \
                         <span class="s2">&quot;event_selectors: params.event_selectors}).map(function(event) {var result = {event: &quot;</span> \
                         <span class="s2">&quot;event.name,properties: {distinct_id: event.distinct_id,time: (event.time / 1000) - &quot;</span> \
                         <span class="s2">&quot;(params.timezone_offset * 3600)}};if (&#39;output_properties&#39; in params) {output_properties = &quot;</span> \
                         <span class="s2">&quot;params.output_properties;} else {output_properties = Object.keys(event.properties);}&quot;</span> \
                         <span class="s2">&quot;_.each(output_properties, prop =&gt; result.properties[prop] = event.properties[prop]);return &quot;</span> \
                         <span class="s2">&quot;result;});}&quot;</span>

            <span class="n">date_format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">from_date</span> <span class="o">=</span> <span class="n">from_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">to_date</span> <span class="o">=</span> <span class="n">to_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">event_selectors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event_selectors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_selectors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">event_selectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">event_selectors</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_selectors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;Invalid type for event_selectors, must be dict or list, found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">event_selectors</span><span class="p">)))</span>

            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;from_date&#39;</span><span class="p">:</span> <span class="n">from_date</span><span class="p">,</span> <span class="s1">&#39;to_date&#39;</span><span class="p">:</span> <span class="n">to_date</span><span class="p">,</span> <span class="s1">&#39;event_selectors&#39;</span><span class="p">:</span> <span class="n">event_selectors</span><span class="p">,</span>
                      <span class="s1">&#39;timezone_offset&#39;</span><span class="p">:</span> <span class="n">timezone_offset</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;people&#39;</span><span class="p">:</span>
            <span class="n">jql_script</span> <span class="o">=</span> <span class="s2">&quot;function main() {return People({user_selectors: params.user_selectors}).map(function(user)&quot;</span> \
                         <span class="s2">&quot; {var result = {$distinct_id: user.distinct_id,$properties: </span><span class="si">{}</span><span class="s2">};if (&#39;output_properties&#39; in&quot;</span> \
                         <span class="s2">&quot; params) {output_properties = params.output_properties;} else {output_properties = &quot;</span> \
                         <span class="s2">&quot;Object.keys(user.properties);}_.each(output_properties, prop =&gt; result.$properties[prop]&quot;</span> \
                         <span class="s2">&quot; = user.properties[prop]);return result;});}&quot;</span>

            <span class="k">if</span> <span class="n">user_selectors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">user_selectors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_selectors</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">user_selectors</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="n">user_selectors</span><span class="p">}]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_selectors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;Invalid type for user_selectors, must be str or list, found: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">user_selectors</span><span class="p">)))</span>
                <span class="k">return</span>

            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_selectors&#39;</span><span class="p">:</span> <span class="n">user_selectors</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Invalid data_type, must be &quot;events&quot; or &quot;people&quot;, found: &#39;</span> <span class="o">+</span> <span class="n">data_type</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">output_properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;output_properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_properties</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_jql</span><span class="p">(</span><span class="n">jql_script</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mixpanel._datasets_request"><a class="viewcode-back" href="../mixpanel_api.html#mixpanel_api.Mixpanel._datasets_request">[docs]</a>    <span class="k">def</span> <span class="nf">_datasets_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">versions_request</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">version_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal base method for making calls to the /datasets API</span>

<span class="sd">        :param method: HTTP method verb: &#39;GET&#39;, &#39;POST&#39;, &#39;PUT&#39;, &#39;DELETE&#39;, &#39;PATCH&#39;</span>
<span class="sd">        :param dataset_id: Name of the dataset to operate on</span>
<span class="sd">        :param versions_request: Boolean indicating whether or not this request goes to /datasets/versions</span>
<span class="sd">        :param version_id: version_id to operate on</span>
<span class="sd">        :param state: version state object for use when updating the version</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :type versions_request: bool</span>
<span class="sd">        :type version_id: str</span>
<span class="sd">        :type state: dict</span>
<span class="sd">        :return: Returns the (parsed json) &#39;data&#39; attribute of the response. Type depends on the specific API call.</span>
<span class="sd">            If there is no &#39;error&#39; and &#39;data&#39; is None, returns True. Otherwise returns False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;datasets&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dataset_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">versions_request</span> <span class="ow">or</span> <span class="n">version_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dataset_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;versions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;dataset_id parameter required to make a request to /versions&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">version_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version_id</span><span class="p">))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="s1">&#39;token required for /datasets API calls!&#39;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BETA_IMPORT_API</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Response: &#39;</span> <span class="o">+</span> <span class="n">response</span><span class="p">)</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Response doesn&#39;t contain a data key, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Mixpanel</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dataset operation error: &#39;</span> <span class="o">+</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mixpanel_api 1.6.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Jared McFarland.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>